{% extends "app_taller/base.html" %}

{% block title %}Nuevo usuario{% endblock %}

{% block content %}

<div class="page-header">
  <div>
    <h2>Nuevo usuario</h2>
    <p class="page-subtitle">
      Crea una nueva cuenta de usuario para el sistema. Se generará una contraseña temporal
      y el usuario deberá cambiarla al iniciar sesión.
    </p>
  </div>

  <a href="{% url 'admin_usuarios_panel' %}" class="btn btn-sm">
    ← Volver al listado
  </a>
</div>

<section class="card" style="max-width:720px;">
  <form method="post" novalidate>
    {% csrf_token %}

    <div class="form-grid-2">
      <div class="form-group">
        <label for="id_rut">RUT</label>
        <input id="id_rut" type="text" name="rut" value="{{ rut|default:'' }}" placeholder="11.111.111-1" required>
        <small class="text-muted">Usar formato chileno estándar.</small>
      </div>

      <div class="form-group">
        <label for="id_email">Correo electrónico</label>
        <input id="id_email" type="email" name="email" value="{{ email|default:'' }}" placeholder="usuario@demo.cl" required>
        <small class="text-muted">Se utilizará como usuario de acceso.</small>
      </div>
    </div>

    <div class="form-grid-2">
      <div class="form-group">
        <label for="id_nombres">Nombres</label>
        <input id="id_nombres" type="text" name="nombres" value="{{ nombres|default:'' }}" required>
      </div>

      <div class="form-group">
        <label for="id_apellidos">Apellidos</label>
        <input id="id_apellidos" type="text" name="apellidos" value="{{ apellidos|default:'' }}" required>
      </div>
    </div>

    <div class="form-grid-2">
      <div class="form-group">
        <label for="id_rol">Rol</label>
        <select id="id_rol" name="rol" required>
          <option value="">Selecciona un rol</option>
          {% for r in roles_disponibles %}
            <option value="{{ r }}" {% if rol == r %}selected{% endif %}>{{ r }}</option>
          {% endfor %}
        </select>
        <small class="text-muted">Define los permisos principales del usuario.</small>
      </div>

      <div class="form-group">
        <label for="id_taller">Taller (opcional)</label>
        <select id="id_taller" name="taller_id">
          <option value="">— Sin asignar —</option>
          {% for t in talleres %}
            <option value="{{ t.id }}" {% if taller_id|stringformat:"s" == t.id|stringformat:"s" %}selected{% endif %}>
              {{ t.nombre }}
            </option>
          {% endfor %}
        </select>
        <small class="text-muted">Solo aplica para perfiles operativos (mecánico, supervisor, etc.).</small>
      </div>
    </div>

    <div class="form-group">
      <label for="id_telefono">Teléfono (opcional)</label>
      <input id="id_telefono" type="text" name="telefono" value="{{ telefono|default:'' }}" placeholder="+56 9 1234 5678">
    </div>

    <hr style="margin:1.25rem 0; opacity:.2;">

    <div class="form-actions">
      <button type="submit" class="btn btn-primary">
        Crear usuario
      </button>
      <a href="{% url 'admin_usuarios_panel' %}" class="btn btn-link">
        Cancelar
      </a>
    </div>
  </form>
</section>

{% endblock %}
